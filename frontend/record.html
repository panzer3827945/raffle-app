<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>抽獎紀錄</title>
<style>
body { font-family: sans-serif; padding: 20px; }
table { border-collapse: collapse; width: 100%; }
th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
button { margin-left: 6px; }
</style>
</head>

<body>
<h2>抽獎紀錄</h2>

密碼：
<input type="password" id="pwd">
<button onclick="load()">表示</button>
<button onclick="clearAll()">履歴削除</button>

<table>
  <thead>
    <tr>
      <th>日時</th>
      <th>名前</th>
      <th>モード</th>
      <th>賞品</th>
      <th>端末ID</th>
    </tr>
  </thead>
  <tbody id="rows"></tbody>
</table>

<script>
function displayMode(mode){
  if(mode === "LIMIT") return "ALL";
  if(mode === "NOLIMIT") return "BINGO";
  return mode;
}

async function load(){
  const pwd = document.getElementById("pwd").value;

  const res = await fetch("/api/history",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ password: pwd })
  });

  if(!res.ok){
    alert("パスワードが違います");
    return;
  }

  const data = await res.json();
  const tbody = document.getElementById("rows");
  tbody.innerHTML = "";

  data.forEach(r=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${r.time}</td>
      <td>${r.name}</td>
      <td>${displayMode(r.mode)}</td>
      <td>${r.prize}</td>
      <td>${r.device}</td>
    `;
    tbody.appendChild(tr);
  });
}

async function clearAll(){
  const pwd = document.getElementById("pwd").value;
  if(!confirm("履歴をすべて削除しますか？")) return;

  const res = await fetch("/api/reset",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ password: pwd })
  });

  if(res.ok){
    alert("履歴を削除しました");
    document.getElementById("rows").innerHTML="";
  }else{
    alert("パスワードが違います");
  }
}
</script>

</body>
</html>
