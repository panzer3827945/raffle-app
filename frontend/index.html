<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">

<!-- æ‰‹æ©Ÿä¸€å®šè¦ -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- é˜²å¿«å–ï¼Œé¿å…èˆŠ JS -->
<meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<title>å¹´ä¼šæŠ½é¸ã‚·ã‚¹ãƒ†ãƒ </title>

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Noto Sans JP",Arial;
  background:linear-gradient(180deg,#f5f8ff,#ffffff);
  text-align:center;
  padding:20px;
}

h2{margin-bottom:20px}

input{
  width:90%;
  max-width:360px;
  padding:16px;
  font-size:18px;
  border-radius:10px;
  border:1px solid #ccc;
  margin-bottom:16px;
}

/* å…±é€šãƒœã‚¿ãƒ³ */
.btn{
  width:90%;
  max-width:360px;
  padding:16px;
  margin:10px auto;
  border:none;
  border-radius:999px;
  font-size:18px;
  color:#fff;
}

/* ALL */
.btn-all{
  background:linear-gradient(135deg,#4A90E2,#2F6FD3);
  box-shadow:0 6px 14px rgba(74,144,226,.35);
}

/* Bingo */
.btn-bingo{
  background:linear-gradient(135deg,#C0392B,#8E2A1F);
  box-shadow:0 6px 14px rgba(192,57,43,.35);
}

.btn-sub{
  background:#555;
}
</style>
</head>

<body>

<h2>ğŸ¯ å¹´ä¼šæŠ½é¸ã‚·ã‚¹ãƒ†ãƒ </h2>

<input id="name" placeholder="ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">

<button class="btn btn-sub" onclick="save()">åå‰ã‚’ä¿å­˜ / å¤‰æ›´</button>

<button class="btn btn-all" onclick="goMode('mode1.html')">
  ALLï¼ˆå…¨å“¡1å›ï¼‰
</button>

<button class="btn btn-bingo" onclick="goMode('mode2.html')">
  Bingo
</button>



<script>
/* =====================================================
 * resetVersion åŒæ­¥ï¼ˆğŸ”¥å…¨è¨­å‚™çµ±ä¸€é‡ç½®çš„æ ¸å¿ƒï¼‰
 * ===================================================== */
async function syncResetVersion(){
  try{
    const res = await fetch("/api/reset-version");
    if(!res.ok) return;

    const data = await res.json();
    const serverVer = String(data.resetVersion);
    const localVer = localStorage.getItem("resetVersion");

    if(localVer !== serverVer){
      // ğŸ”¥ é‡é»ï¼šæ¸…æ‰ã€Œä¸èƒ½å†æŠ½ã€çš„æœ¬æ©Ÿè¨˜æ†¶
      localStorage.removeItem("played");
      localStorage.removeItem("deviceId");

      localStorage.setItem("resetVersion", serverVer);
      console.log("reset synced:", serverVer);
    }
  }catch(e){
    console.warn("resetVersion sync failed");
  }
}

/* é é¢ä¸€é–‹å°±åŒæ­¥ä¸€æ¬¡ */
syncResetVersion();

/* =====================================================
 * åç¨±è™•ç†
 * ===================================================== */
const input = document.getElementById("name");
input.value = localStorage.getItem("raffleName") || "";

function save(){
  const n = input.value.trim();
  if(!n){
    alert("ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
    return;
  }
  localStorage.setItem("raffleName", n);
  alert("åå‰ã‚’æ›´æ–°ã—ã¾ã—ãŸ");
}

/* =====================================================
 * é€²å…¥æŠ½çæ¨¡å¼ï¼ˆä¿è­‰ reset åŒæ­¥å¾Œå†é€²ï¼‰
 * ===================================================== */
async function goMode(url){
  await syncResetVersion();

  const name = localStorage.getItem("raffleName");
  if(!name){
    alert("å…ˆã«ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
    return;
  }

  location.href = url;
}
</script>

</body>
</html>

