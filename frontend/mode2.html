<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¹´ä¼šæŠ½é¸ï¼ˆBingoï¼‰</title>

<script src="shared.js"></script>

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Hiragino Sans","Noto Sans JP",Arial;
  background:linear-gradient(180deg,#fff4f2,#ffffff);
  text-align:center;
  padding:16px;
}
h2{margin:12px 0;font-weight:700}
.btn{
  width:90%;
  max-width:360px;
  padding:16px;
  margin:14px auto;
  border:none;
  border-radius:999px;
  background:linear-gradient(135deg,#c0392b,#8e2a1f);
  color:#fff;
  font-size:18px;
}
.stage{width:340px;height:340px;margin:14px auto;position:relative}
canvas{width:340px;height:340px}
.pointer{
  position:absolute;right:-10px;top:50%;transform:translateY(-50%);
  width:0;height:0;
  border-top:16px solid transparent;
  border-bottom:16px solid transparent;
  border-right:32px solid #c0392b;
}
#result{font-size:20px;font-weight:700}
</style>
</head>

<body>

<h2>ğŸ‰ å¹´ä¼šæŠ½é¸ï¼ˆBingoï¼‰</h2>
<button class="btn" onclick="location.href='index.html'">â† ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</button>

<div class="stage">
  <canvas id="wheel" width="340" height="340"></canvas>
  <div class="pointer"></div>
</div>

<button class="btn" onclick="startDraw()">æŠ½é¸ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
<div id="result"></div>

<script>
/* resetVersion æŠ½çå‰åŒæ­¥ */
async function syncResetVersionBeforeDraw(){
  try{
    const r=await fetch("/api/reset-version",{cache:"no-store"});
    const d=await r.json();
    const sv=String(d.resetVersion);
    const lv=localStorage.getItem("resetVersion");
    if(lv!==sv){
      localStorage.setItem("resetVersion",sv);
    }
  }catch(e){}
}

/* æŠ½çæµç¨‹ */
async function startDraw(){
  await syncResetVersionBeforeDraw();

  const name=localStorage.getItem("raffleName");
  if(!name) return alert("ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã§åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

  const prize=Math.random()<0.7?1000:Math.random()<0.9?500:100;
  await submitRecord(name,prize,"NOLIMIT");
  result.innerText=`${name} ã•ã‚“ï¼š${prize} å½“é¸`;
}
</script>
</body>
</html>
